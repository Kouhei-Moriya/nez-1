/*

  Nez Regex Grammar

  Author:
    Shun Honda (https://github.com/shun-honda)
		Masanori Sato (https://github.com/masanori-10)

*/

File
	= Chunk .*

Chunk
	= Pattern

Pattern
	= { @Expr #Pattern }

Expr
	= Concatenation {@ ('|' @Concatenation) #Or }*

Concatenation
	= IndependentExpr {@ (@IndependentExpr) #Concatenation }*

IndependentExpr
	= { '(?>' @Concatenation ')' #IndependentExpr }
	/ Predicate

Predicate
	= { '(' ('?=' #And / '?!' #Not) @Concatenation ')' }
	/ SuffixTerminal

SuffixTerminal
	= Terminal {@ addQuantifiers }?

addQuantifiers
	= '*+' #PossessiveRepetition
	/ '*?' #LazyQuantifiers
	/ '*' #Repetition
	/ '+' #OneMoreRepetition
	/ '?' #Option
	/ '{' @{ INT #N } '}' #NTimesRepetition
	/ '{' @{ INT #N } ',}' #NMoreRepetition
	/ '{' @{ INT #N } ',' @{ INT #M } '}' #NtoMTimesRepetition

INT
	= [1-9] [0-9]* / '0'

Terminal
	= CharacterSet
	/ { '.' #Any }
	/ '(' { @Expr #Capture } ')'
	/ PositionAnchor
	/ Character

CharacterSet
	= '[^' { @CharacterRange (@CharacterRange)* #NegativeCharacterSet} ']'
	/'[' !'^' CharacterRange {@ (@CharacterRange)+ #CharacterSet}? ']'

CharacterRange
	= CharacterSetItem {@ '-' @CharacterSetItem #CharacterRange }?

CharacterSetItem
	= { CHARACTER_SET_ITEM #Character }

CHARACTER_SET_ITEM
	= '\\u' HEX HEX HEX HEX
	/ '\\n'
	/ '\\t'
	/ '\\\\'
	/ '\\r'
	/ '\\f'
	/ '\\['
	/ '\\]'
	/ '\\-'
	/ !('-'/'['/']') .

HEX
	= [0-9A-Fa-f]

PositionAnchor
	= { '^' #Header }
	/ { '$' #Terminator }

Character
	= { CHARACTER #Character }

CHARACTER
	= '\\u' HEX HEX HEX HEX
	/ '\\n'
	/ '\\t'
	/ '\\\\'
	/ '\\r'
	/ '\\f'
	/ '\\' METACHARACTER
	/ !METACHARACTER !'\n' .

METACHARACTER
	= '+' / '*' / '?' / '.' / '^' / '$' / '|' / '/'
	/ '(' / ')' / '[' / ']' / '{' / '}' / '-'
